<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>

<StackPane prefHeight="1080" prefWidth="1920" styleClass="field-bg" xmlns="http://javafx.com/javafx/25" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.farmingcmulator.controller.FieldController">
    <ImageView fx:id="backgroundImage" fitHeight="1080.0" fitWidth="1920.0" pickOnBounds="true">
        <image>
            <Image url="@../images/field_spring.png" />
        </image>
    </ImageView>

    <BorderPane>

        <!-- HEADER -->
        <top>
            <HBox alignment="CENTER" spacing="30" styleClass="status-bar">
                <padding>
                    <Insets bottom="15" left="40" right="40" top="15" />
                </padding>
                <Label styleClass="page-title-small" text="MY FIELD" />
                <Region HBox.hgrow="ALWAYS" />
                <Label fx:id="seasonLabel" styleClass="status-value" text="Spring" />
                <Region prefWidth="20" />
                <Label fx:id="actionsLabel" styleClass="status-value" text="Actions: 10" />
            </HBox>
        </top>

        <!-- MAIN CONTENT -->
        <center>
            <VBox alignment="CENTER" spacing="18">
                <padding>
                    <Insets bottom="15" left="40" right="40" top="15" />
                </padding>

                <!-- Instruction -->
                <Label styleClass="subtitle-on-bg" text="Select an action, then click on a plot" />

                <!-- MARKET TRENDS PANEL -->
                <HBox alignment="CENTER" spacing="20">
                    <VBox alignment="CENTER" spacing="8" styleClass="market-panel">
                        <padding><Insets bottom="12" left="20" right="20" top="12" /></padding>

                        <HBox alignment="CENTER" spacing="15">
                            <Label styleClass="market-title" text="MARKET TRENDS" />
                            <Label fx:id="priceUpdateLabel" styleClass="market-update" text="Updates in: 3 days" />
                        </HBox>

                        <HBox alignment="CENTER" spacing="30">
                            <!-- HIGH DEMAND Column -->
                            <VBox alignment="CENTER" spacing="4">
                                <Label styleClass="market-subtitle-good" text="HIGH DEMAND" />
                                <VBox alignment="CENTER_LEFT" spacing="2" styleClass="market-list">
                                    <Label fx:id="goodPrice1" styleClass="market-item-good" text="Loading..." />
                                    <Label fx:id="goodPrice2" styleClass="market-item-good" text="Loading..." />
                                    <Label fx:id="goodPrice3" styleClass="market-item-good" text="Loading..." />
                                </VBox>
                            </VBox>

                            <!-- LOW DEMAND Column -->
                            <VBox alignment="CENTER" spacing="4">
                                <Label styleClass="market-subtitle-bad" text="LOW DEMAND" />
                                <VBox alignment="CENTER_LEFT" spacing="2" styleClass="market-list">
                                    <Label fx:id="badPrice1" styleClass="market-item-bad" text="Loading..." />
                                    <Label fx:id="badPrice2" styleClass="market-item-bad" text="Loading..." />
                                    <Label fx:id="badPrice3" styleClass="market-item-bad" text="Loading..." />
                                </VBox>
                            </VBox>
                        </HBox>
                    </VBox>
                </HBox>

                <Region prefHeight="4" />

                <!-- PLOTS - Row 1 (Plot 1-5) -->
                <HBox alignment="CENTER" spacing="12">

                    <!-- Plot 1 -->
                    <StackPane fx:id="plot1Box" onMouseClicked="#onPlot1Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <!-- Top section: Image + Name -->
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot1Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot1Label" styleClass="plot-crop-name" text="Empty" wrapText="true" />
                            </VBox>
                            <!-- Bottom section: Water + Days -->
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot1Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot1Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <!-- Plot number badge -->
                        <Label fx:id="plot1Number" styleClass="plot-badge" text="1" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                    <!-- Plot 2 -->
                    <StackPane fx:id="plot2Box" onMouseClicked="#onPlot2Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot2Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot2Label" styleClass="plot-crop-name" text="Empty" wrapText="true" />
                            </VBox>
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot2Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot2Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <Label fx:id="plot2Number" styleClass="plot-badge" text="2" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                    <!-- Plot 3 -->
                    <StackPane fx:id="plot3Box" onMouseClicked="#onPlot3Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot3Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot3Label" styleClass="plot-crop-name" text="Empty" wrapText="true" />
                            </VBox>
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot3Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot3Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <Label fx:id="plot3Number" styleClass="plot-badge" text="3" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                    <!-- Plot 4 -->
                    <StackPane fx:id="plot4Box" onMouseClicked="#onPlot4Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot4Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot4Label" styleClass="plot-crop-name" text="Empty" wrapText="true" />
                            </VBox>
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot4Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot4Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <Label fx:id="plot4Number" styleClass="plot-badge" text="4" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                    <!-- Plot 5 -->
                    <StackPane fx:id="plot5Box" onMouseClicked="#onPlot5Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot5Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot5Label" styleClass="plot-crop-name" text="Empty" wrapText="true" />
                            </VBox>
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot5Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot5Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <Label fx:id="plot5Number" styleClass="plot-badge" text="5" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                </HBox>

                <!-- PLOTS - Row 2 (Plot 6-10) -->
                <HBox alignment="CENTER" spacing="12">

                    <!-- Plot 6 -->
                    <StackPane fx:id="plot6Box" onMouseClicked="#onPlot6Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot6Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot6Label" styleClass="plot-crop-name" text="Locked" wrapText="true" />
                            </VBox>
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot6Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot6Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <Label fx:id="plot6Number" styleClass="plot-badge" text="6" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                    <!-- Plot 7 -->
                    <StackPane fx:id="plot7Box" onMouseClicked="#onPlot7Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot7Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot7Label" styleClass="plot-crop-name" text="Locked" wrapText="true" />
                            </VBox>
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot7Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot7Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <Label fx:id="plot7Number" styleClass="plot-badge" text="7" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                    <!-- Plot 8 -->
                    <StackPane fx:id="plot8Box" onMouseClicked="#onPlot8Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot8Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot8Label" styleClass="plot-crop-name" text="Locked" wrapText="true" />
                            </VBox>
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot8Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot8Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <Label fx:id="plot8Number" styleClass="plot-badge" text="8" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                    <!-- Plot 9 -->
                    <StackPane fx:id="plot9Box" onMouseClicked="#onPlot9Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot9Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot9Label" styleClass="plot-crop-name" text="Locked" wrapText="true" />
                            </VBox>
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot9Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot9Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <Label fx:id="plot9Number" styleClass="plot-badge" text="9" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                    <!-- Plot 10 -->
                    <StackPane fx:id="plot10Box" onMouseClicked="#onPlot10Clicked" styleClass="plot-card">
                        <VBox alignment="CENTER" styleClass="plot-card-inner">
                            <VBox alignment="CENTER" spacing="4" styleClass="plot-card-top" VBox.vgrow="ALWAYS">
                                <ImageView fx:id="plot10Image" fitHeight="64" fitWidth="64" preserveRatio="true" />
                                <Label fx:id="plot10Label" styleClass="plot-crop-name" text="Locked" wrapText="true" />
                            </VBox>
                            <HBox alignment="CENTER" spacing="12" styleClass="plot-card-bottom">
                                <Label fx:id="plot10Water" styleClass="plot-stat" text="" />
                                <Label fx:id="plot10Days" styleClass="plot-stat" text="" />
                            </HBox>
                        </VBox>
                        <Label fx:id="plot10Number" styleClass="plot-badge" text="10" StackPane.alignment="TOP_LEFT" />
                    </StackPane>

                </HBox>

                <Region prefHeight="8" />

                <!-- ACTION BUTTONS -->
                <HBox alignment="CENTER" spacing="20">
                    <Button fx:id="plantButton" onAction="#onPlantClicked" prefHeight="60" prefWidth="160" styleClass="field-action-btn-plant" text="PLANT" />
                    <Button fx:id="waterButton" onAction="#onWaterClicked" prefHeight="60" prefWidth="160" styleClass="field-action-btn-water" text="WATER" />
                    <Button fx:id="fertilizeButton" onAction="#onFertilizeClicked" prefHeight="60" prefWidth="160" styleClass="field-action-btn-fertilize" text="FERTILIZE" />
                    <Button fx:id="harvestButton" onAction="#onHarvestClicked" prefHeight="60" prefWidth="160" styleClass="field-action-btn-harvest" text="HARVEST" />
                </HBox>

            </VBox>
        </center>

        <!-- FOOTER -->
        <bottom>
            <HBox alignment="CENTER">
                <padding><Insets bottom="25" top="12" /></padding>
                <Button onAction="#onBackClicked" prefHeight="45" prefWidth="200" styleClass="menu-btn-back" text="BACK TO FARM" />
            </HBox>
        </bottom>

        <!-- STORAGE SIDEBAR -->
        <right>
            <VBox fx:id="storagePanel" alignment="TOP_CENTER" fillWidth="false" maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" prefWidth="375.0" spacing="12" styleClass="storage-panel" BorderPane.alignment="CENTER_RIGHT">
                <padding><Insets bottom="20" left="15" right="20" top="20" /></padding>

                <!-- Storage Header -->
                <HBox alignment="CENTER" spacing="10">
                    <Label styleClass="storage-title" text="STORAGE" />
                    <Label fx:id="storageCapacityLabel" styleClass="storage-capacity" text="0/10" />
                </HBox>

                <!-- Storage Table -->
                <TableView fx:id="storageTable" prefHeight="340" prefWidth="340" styleClass="storage-table">
                    <columns>
                        <TableColumn fx:id="storageCropColumn" prefWidth="110" text="Crop" />
                        <TableColumn fx:id="storageQtyColumn" prefWidth="40" text="Qty" />
                        <TableColumn fx:id="storageQualityColumn" prefWidth="60" text="Qlty" />
                        <TableColumn fx:id="storagePriceColumn" prefWidth="90" text="Value" />
                    </columns>
                    <placeholder>
                        <Label styleClass="storage-empty" text="No crops stored" />
                    </placeholder>
                </TableView>

                <!-- Decay Warning -->
                <VBox fx:id="decayWarningBox" alignment="CENTER" spacing="4" styleClass="storage-warning-box" managed="false" visible="false">
                    <Label styleClass="storage-warning-title" text="QUALITY DECAY WARNING" />
                    <Label fx:id="decayWarningLabel" styleClass="storage-warning-text" text="" wrapText="true" />
                </VBox>

                <!-- Sell Buttons -->
                <HBox alignment="CENTER" spacing="10">
                    <Button fx:id="sellButton" onAction="#onSellClicked" prefHeight="40" prefWidth="140" styleClass="storage-btn-sell" text="SELL" />
                    <Button fx:id="sellAllButton" onAction="#onSellAllClicked" prefHeight="40" prefWidth="140" styleClass="storage-btn-sell-all" text="SELL ALL" />
                </HBox>

                <!-- Total Value -->
                <Label fx:id="storageTotalLabel" styleClass="storage-total" text="Total Value: 0 coins" />
            </VBox>
        </right>

    </BorderPane>

    <!-- PEST INVASION POPUP -->
    <VBox fx:id="pestPopup" alignment="CENTER" managed="false" styleClass="overlay-bg" visible="false">
        <VBox maxWidth="450" minWidth="400" spacing="18" styleClass="popup-box-pest">
            <padding><Insets bottom="28" left="38" right="38" top="28" /></padding>
            <Label styleClass="pest-popup-title" text="PEST INVASION!" />
            <Label styleClass="pest-popup-icon" text="ðŸ›" />
            <Label fx:id="pestPopupLabel" styleClass="pest-popup-text" text="" wrapText="true" />
            <Label styleClass="pest-popup-hint" text="Fertilized crops have lower pest risk!" />
            <Button onAction="#onPestPopupClose" prefWidth="120" styleClass="menu-btn-primary" text="OK" />
        </VBox>
    </VBox>

    <!-- INFO POPUP -->
    <VBox fx:id="infoPopup" alignment="CENTER" managed="false" styleClass="overlay-bg" visible="false">
        <VBox maxWidth="400" minWidth="350" spacing="18" styleClass="popup-box-small">
            <padding><Insets bottom="25" left="35" right="35" top="25" /></padding>
            <Label fx:id="infoPopupLabel" styleClass="popup-text-small" text="" wrapText="true" />
            <Button onAction="#onInfoPopupClose" prefWidth="100" styleClass="menu-btn-primary" text="OK" />
        </VBox>
    </VBox>

    <!-- INVENTORY POPUP -->
    <VBox fx:id="inventoryPopup" alignment="CENTER" managed="false" styleClass="overlay-bg" visible="false">
        <VBox maxWidth="450" minWidth="400" spacing="20" styleClass="popup-box">
            <padding><Insets bottom="28" left="35" right="35" top="28" /></padding>
            <Label styleClass="popup-title" text="SELECT SEED" />
            <Label styleClass="popup-submessage" text="Choose a seed from your inventory" />
            <ListView fx:id="inventoryListView" prefHeight="220" prefWidth="340" styleClass="inventory-list" />
            <HBox alignment="CENTER" spacing="20">
                <Button onAction="#onCropSelected" prefHeight="45" prefWidth="120" styleClass="menu-btn-primary" text="PLANT" />
                <Button onAction="#onInventoryCancel" prefHeight="45" prefWidth="120" styleClass="menu-btn-back" text="CANCEL" />
            </HBox>
        </VBox>
    </VBox>

    <!-- HARVEST RESULT POPUP -->
    <VBox fx:id="harvestResultPopup" alignment="CENTER" managed="false" styleClass="overlay-bg" visible="false">
        <VBox maxWidth="480" minWidth="420" spacing="18" styleClass="popup-box-success">
            <padding><Insets bottom="30" left="40" right="40" top="30" /></padding>

            <Label styleClass="popup-title-success" text="HARVEST SUCCESS!" />
            <Label fx:id="harvestCropLabel" styleClass="harvest-crop-name" text="Crop Name" />

            <!-- Quality Section -->
            <VBox alignment="CENTER" spacing="8" style="-fx-background-color: rgba(255,255,255,0.6); -fx-background-radius: 12; -fx-padding: 12;">
                <Label styleClass="popup-label" text="QUALITY" />
                <ProgressBar fx:id="harvestQualityBar" prefWidth="280" progress="0.5" styleClass="quality-bar" />
                <HBox alignment="CENTER" spacing="15">
                    <Label fx:id="harvestQualityLabel" styleClass="harvest-quality" text="50%" />
                    <Label fx:id="harvestGradeLabel" styleClass="harvest-grade" text="GOOD" />
                </HBox>
            </VBox>

            <Label fx:id="harvestMessageLabel" styleClass="harvest-message" text="Message" wrapText="true" />

            <!-- Price Breakdown -->
            <VBox alignment="CENTER" spacing="6" styleClass="harvest-price-box">
                <padding><Insets bottom="12" left="20" right="20" top="12" /></padding>
                <HBox alignment="CENTER" spacing="10">
                    <Label styleClass="popup-label" text="Base Price:" />
                    <Label fx:id="harvestBaseLabel" styleClass="harvest-price" text="50 coins" />
                </HBox>
                <HBox alignment="CENTER" spacing="10">
                    <Label styleClass="popup-label" text="Quality Bonus:" />
                    <Label fx:id="harvestBonusLabel" styleClass="harvest-bonus" text="+25 coins" />
                </HBox>
                <Region prefHeight="3" />
                <HBox alignment="CENTER" spacing="10">
                    <Label styleClass="popup-label-bold" text="TOTAL:" />
                    <Label fx:id="harvestTotalLabel" styleClass="harvest-total" text="75 coins" />
                </HBox>
            </VBox>

            <Button onAction="#onHarvestResultClose" prefHeight="45" prefWidth="160" styleClass="menu-btn-primary" text="COLLECT" />
        </VBox>
    </VBox>

</StackPane>
